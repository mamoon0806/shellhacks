<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>
    Home - WalkMe
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="../css/globals.css" rel="stylesheet">

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxn11dlm134OPDCeb18AgK5B-rjlQ7msg&callback=initMap"
    async defer></script>
</head>

<body>
  <main class="w-full min-h-screen py-8">
    <section class="items-center">
      <h1 class="h1 font-bold text-2xl">
        <p class="text-center">
          WalkMe
        </p>
      </h1>5
      <h2 class="h2 text-xl">
        <p class="text-center">
          A web application to help you find the safest route to your destination.
        </p>
      </h2>
      <input type="text" id="destination" placeholder="Enter destination address">
      <button onclick="calculateAndDisplayRoute()">Get Directions</button>
      <!-- Map container -->
      <div id="map" style="height: 400px; width: 100%;"></div>
    </section>
  </main>

  <!-- Add your JavaScript code here -->
  <script>
    let map;
    let directionsService;
    let directionsRenderer;

    function initMap() {
      // Create a map centered at the user's current location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const currentLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            map = new google.maps.Map(document.getElementById('map'), {
              zoom: 12,
              center: currentLocation
            });

            // Display the user's location indicator as a red arrow
            /*const arrowIcon = {
              path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
              scale: 5,
              fillColor: "red",
              fillOpacity: 1,
              strokeWeight: 1,
              rotation: position.coords.heading // Use the user's heading for rotation
            };*/

            new google.maps.Marker({
              position: currentLocation,
              map: map,
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({ map: map });
          },
          () => {
            alert('Error: The Geolocation service failed.');
          }
        );
      } else {
        alert("Error: Your browser doesn't support geolocation.");
      }
    }

    function calculateAndDisplayRoute() {
      const destination = document.getElementById('destination').value;

      if (!destination) {
        alert('Please enter a destination address.');
        return;
      }

      const origin = map.getCenter();

      const request = {
        origin: origin,
        destination: destination,
        travelMode: 'DRIVING' // You can change the travel mode as needed
      };

      directionsService.route(request, (result, status) => {
        if (status === 'OK') {
          directionsRenderer.setDirections(result);
        } else {
          alert('Error: ' + status);
        }
      });
    }
  </script>

</body>

</html>